BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["rich-editor-view-template"]='  <div class="rich-editor-view">    <div class="controlbox">       <div class="button" style="float: left"><div class="buttonicon icon ui-icon-power"></div></div>       <div class="button" style="float: left"><div class="buttonicon icon ui-icon-phone"></div></div>       <div class="button" style="float: left"><div class="buttonicon icon ui-icon-apple"></div></div>   </div>   <div class="editbox">   </div>  </div> ',BetaJS.Templates.Cached["simple-rich-editor-content-view-template"]='  <div class="simple-rich-editor-content-view" contenteditable="true" data-selector="inner" data-view-id="{%= supp.view_id %}">   {%= content %}  </div> ',BetaJS.Views.View.extend("BetaJS.Views.SimpleRichEditorContentView",{_templates:{"default":BetaJS.Templates.Cached["simple-rich-editor-content-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.SimpleRichEditorContentView,"constructor",a),this._setOptionProperty(a,"content",""),this._selector="[data-view-id='"+this.cid()+"']",this.__wasKeyPress=!1},_events:[{"blur [data-selector='inner']":"__change","keyup [data-selector='inner']":"__change","paste [data-selector='inner']":"__change","keypress [data-selector='inner']":"__key_press","keyup [data-selector='inner']":"__key_up","click  [data-selector='inner']":"__click"}],__key_press:function(a){this.__wasKeyPress=!0,0!==a.which&&this.trigger("insert"),this.trigger("select"),this.trigger("element")},__key_up:function(){this.__wasKeyPress||(this.trigger("insert"),this.trigger("select"),this.trigger("element")),this.__wasKeyPress=!1},__click:function(){this.trigger("select"),this.trigger("element")},__change:function(){this.set("content",this._editor.html())},_render:function(){this._inherited(BetaJS.Views.SimpleRichEditorContentView,"_render"),this._editor=this.$("[data-selector='inner']")},hasFocus:function(){return document.activeElement==this._editor.get(0)||BetaJS.$(document.activeElement).parents(this._selector).length>0}}),BetaJS.Views.SimpleRichEditorContentView.extend("BetaJS.Views.RichEditorContentView",{constructor:function(a){this._inherited(BetaJS.Views.RichEditorContentView,"constructor",a),this.__caretElementStack={},this.on("select",function(){this.__caretClearElementStack()},this),this.on("insert",function(){this.__caretCharacterAdded()},this)},caretNodeOffset:function(){return BetaJS.Browser.Dom.selectionOffset()},hasParentElement:function(a){return this.isSelected()?this.selectionHasParentElement(a):this.caretHasParentElement(a)},setParentElement:function(a,b){this.isSelected()?this.selectionSetParentElement(a,b):this.caretSetParentElement(a,b)},isSelected:function(){return this.hasFocus()&&""!=BetaJS.Browser.Dom.selectedHtml()},selectionAncestor:function(){return BetaJS.Browser.Dom.selectionAncestor()},selection:function(){return BetaJS.Browser.Dom.selectionNodes()},selectionLeaves:function(){return BetaJS.Browser.Dom.selectionLeaves()},selectionHasParentElement:function(a){return this.hasFocus()?this.selectionAncestor().parents(this._selector+" "+a).length>0?!0:BetaJS.Objs.all(this.selectionLeaves(),function(b){return b.parents(this._selector+" "+a).length>0||BetaJS.Types.is_defined(b.get(0).tagName)&&b.get(0).tagName.toLowerCase()==a.toLowerCase()},this):void 0},selectionSetParentElement:function(a,b){if(this.hasFocus()){var c=this.selectionHasParentElement(a);BetaJS.Types.is_undefined(b)&&(b=!c),b!=c&&(b?this.selectionAddParentElement(a):this.selectionRemoveParentElement(a))}},selectionAddParentElement:function(){!this.hasFocus()},selectionRemoveParentElement:function(){!this.hasFocus()},caretNode:function(){return BetaJS.Browser.Dom.selectionStartNode()},caretHasParentElement:function(a){return BetaJS.Types.is_defined(this.__caretElementStack[a])?this.__caretElementStack[a]:this.caretNode().parents(this._selector+" "+a).length>0},caretSetParentElement:function(a,b){var c=this.caretHasParentElement(a);BetaJS.Types.is_undefined(b)&&(b=!c),b!=c&&(b?this.caretAddParentElement(a):this.caretRemoveParentElement(a))},caretAddParentElement:function(a){this.caretHasParentElement(a)||(this.__caretElementStack[a]=!0,this.trigger("element"))},__caretCharacterAdded:function(){var a=[],b=[];BetaJS.Objs.iter(this.__caretElementStack,function(c,d){c?a.push(d):b.push(d)});var c=this.caretNodeOffset(),d=this.caretNode(),e=d.parent().get(0),f=d.get(0),g=f.splitText(c),h=f.splitText(c-1),i=h;h.data;for(var j=0;j<a.length;++j){var k=document.createElement(a[j]);k.appendChild(h),h=k,e.insertBefore(h,g)}BetaJS.Browser.Dom.selectNode(i,1)},__caretClearElementStack:function(){this.__caretElementStack={}},caretRemoveParentElement:function(a){this.caretHasParentElement(a)&&(this.__caretElementStack[a]=!1,this.trigger("element"))}}),BetaJS.Views.ListContainerView.extend("BetaJS.Views.RichEditorView",{constructor:function(a){a=a||{},a.el="body",a.el_classes="rich-editor-view",a.alignment="vertical",this._inherited(BetaJS.Views.RichEditorView,"constructor",a),this._setOptionProperty(a,"content",""),this.ns.editor_view.on("element",function(){this.trigger("element-slow")},this,{min_delay:50,max_delay:200})},_domain:function(){return{toolbar:{type:"ListContainerView",options:{el_classes:"toolbar"}},font_style_dropdown:{type:"ButtonView",parent:"toolbar",options:{label:"Font"},events:{click:function(){alert("Dropdown change font-style")}}},font_size_dropdown:{type:"ButtonView",parent:"toolbar",options:{label:"16"},events:{click:function(){alert("Dropdown change font-size")}}},seperator1:{type:"BetaJS.Views.View",parent:"toolbar",options:{el_classes:"seperator"}},bold_button:{type:"ButtonView",parent:"toolbar",options:{label:"B",children_classes:"bold",hotkey:"ctrl+b"},events:{click:function(){this.domain.ns.editor_view.setParentElement("strong")}},listeners:{"element-slow":function(){this.set("selected",this.domain.ns.editor_view.hasParentElement("strong"))}}},italic_button:{type:"ButtonView",parent:"toolbar",options:{label:"I",children_classes:"italic",hotkey:"ctrl+i"},events:{click:function(){this.domain.ns.editor_view.setParentElement("i")}},listeners:{"element-slow":function(){this.set("selected",this.domain.ns.editor_view.hasParentElement("i"))}}},underline_button:{type:"ButtonView",parent:"toolbar",options:{label:"U",children_classes:"underline"},events:{click:function(){alert("Underline")}}},seperator2:{type:"BetaJS.Views.View",parent:"toolbar",options:{el_classes:"seperator"}},left_align_button:{type:"ButtonView",parent:"toolbar",options:{label:"L",children_classes:"icon-align-left"},events:{click:function(){alert("text-align: left")}}},center_align_button:{type:"ButtonView",parent:"toolbar",options:{label:"C"},events:{click:function(){alert("text-align: center")}}},right_align_button:{type:"ButtonView",parent:"toolbar",options:{label:"R"},events:{click:function(){alert("text-align: right")}}},justify_align_button:{type:"ButtonView",parent:"toolbar",options:{label:"J"},events:{click:function(){alert("text-align: justify")}}},editor_view:{type:"BetaJS.Views.RichEditorContentView",el:".editbox",options:function(a){return{children_classes:"textareadiv",content:a.binding("content")}}}}}});